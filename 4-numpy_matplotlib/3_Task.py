"""
–ó–∞–¥–∞–Ω–∏–µ 3. 
–ò–º–µ–µ—Ç—Å—è –¥–∞—Ç–∞—Å–µ—Ç –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ (–ø—Ä–∏–ª–æ–∂–µ–Ω –∫ –î–ó: ozon_bestsellers_2024-10-27_21_42). 
–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Ñ–æ—Ä–º–∞—Ç (–≤–æ–∑–º–æ–∂–Ω–æ, –µ–≥–æ –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ CSV)
–ú–æ–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ª—é–±—ã–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Å–≤–æ–µ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ, –∫ –ø—Ä–∏–º–µ—Ä—É:
- –¢–æ–ø-5 —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
- –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ì—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏ –æ–±–æ—Ä–æ—Ç–∞ (—Ä–æ—Å—Ç –∏–ª–∏ –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂ –ø–æ —Ç–æ–≤–∞—Ä—É)
- –í–ª–∏—è–Ω–∏–µ —Ü–µ–Ω—ã –Ω–∞ –∑–∞–∫–∞–∑—ã (–°—Ä–∞–≤–Ω–∏—Ç—å —Å—Ç–æ–ª–±—Ü—ã –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –∏ –ó–∞–∫–∞–∑–∞–Ω–æ, —à—Ç—É–∫–∏)
–ü–æ—Å–ª–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–µ–∫—Ü–∏–∏ –ø–æ Pandas –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏–∏—Ç—å –µ–≥–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
"""

import matplotlib
matplotlib.use("TkAgg") # –£–∫–∞–∑—ã–≤–∞—é –±—ç–∫–µ–Ω–¥, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –≤–µ—Ä—Å–∏–π —Å–æ —Å—Ä–µ–¥–æ–π
import matplotlib.pyplot as plt 
import pandas as pd

# 1. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è "–¢–æ–ø-5 —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤"
# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ–ø-–ø–µ—Ä–µ—á–Ω—è –ª—É—á—à–µ –≤—Å–µ–≥–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–º - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –±–µ–∑—ã–¥–µ–π–Ω—ã–π –ø—Ä–∏–Ω—Ç
df = pd.read_excel('4-numpy_matplotlib/ozon_bestsellers_2024-10-27_21_42.xlsx')
top_expensive = df[['–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', '–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞, ‚ÇΩ']].sort_values('–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞, ‚ÇΩ', ascending=False).head(5)
print()
print('1. –¢–æ–ø-5 —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤\n')
print(top_expensive)

# 2. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è "–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
avg_price_by_cat  = df.groupby('–ö–∞—Ç–µ–≥–æ—Ä–∏—è 3 —É—Ä–æ–≤–Ω—è')['–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞, ‚ÇΩ'].mean().sort_values(ascending=False)
print()
print('2. –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏\n')
print(avg_price_by_cat)

# 3. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è "–ì—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏ –æ–±–æ—Ä–æ—Ç–∞ (—Ä–æ—Å—Ç –∏–ª–∏ –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂ –ø–æ —Ç–æ–≤–∞—Ä—É)"
# –¢–æ–≤–∞—Ä—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ 3 —É—Ä–æ–≤–Ω—è, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è–º–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤.
# –¢–æ–≤–∞—Ä—ã –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ –¥–∏–Ω–∞–º–∏–∫–µ –∏—Å–∫–ª—é—á–µ–Ω—ã, —á—Ç–æ–±—ã –Ω–µ –≤–ª–∏—è—Ç—å –Ω–∞ —Ä–∞—Å—á—ë—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.
# –ü—Ä–æ—Ü–µ–Ω—Ç—ã –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ 10–∫, —á—Ç–æ —Å—Ç—Ä–∞–Ω–Ω–æ. –ù–æ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Äü§î

# –ò—Å–∫–ª—é—á–∞–µ–º –∏–∑ –ø–æ–¥—Å—á—ë—Ç–∞ —Å—Ç—Ä–æ–∫–∏ —Å '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'
df['–î–∏–Ω–∞–º–∏–∫–∞ –æ–±–æ—Ä–æ—Ç–∞, %'] = pd.to_numeric(df['–î–∏–Ω–∞–º–∏–∫–∞ –æ–±–æ—Ä–æ—Ç–∞, %'], errors='coerce') 
data = df[['–ö–∞—Ç–µ–≥–æ—Ä–∏—è 3 —É—Ä–æ–≤–Ω—è', '–î–∏–Ω–∞–º–∏–∫–∞ –æ–±–æ—Ä–æ—Ç–∞, %']].dropna()

avg_dynamic_by_cat = data.groupby('–ö–∞—Ç–µ–≥–æ—Ä–∏—è 3 —É—Ä–æ–≤–Ω—è')['–î–∏–Ω–∞–º–∏–∫–∞ –æ–±–æ—Ä–æ—Ç–∞, %'].mean().sort_values()

plt.figure(figsize=(22, 12)) # –ó–∞–¥–∞—ë–º —Ñ–æ–Ω –ø–æ–±–æ–ª—å—à–µ, —Ç.–∫. –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ –±—É–¥–µ—Ç –º–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–π
plt.barh(
    avg_dynamic_by_cat.index,
    avg_dynamic_by_cat.values
)

plt.axvline(0)  # –ª–∏–Ω–∏—è –Ω—É–ª—è - –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
plt.xlabel('–°—Ä–µ–¥–Ω—è—è –¥–∏–Ω–∞–º–∏–∫–∞ –æ–±–æ—Ä–æ—Ç–∞, %')
plt.title('–°—Ä–µ–¥–Ω—è—è –¥–∏–Ω–∞–º–∏–∫–∞ –æ–±–æ—Ä–æ—Ç–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º 3 —É—Ä–æ–≤–Ω—è')
plt.yticks(rotation=10)
plt.show()


# 4. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è "–í–ª–∏—è–Ω–∏–µ —Ü–µ–Ω—ã –Ω–∞ –∑–∞–∫–∞–∑—ã"
plt.scatter(
    df["–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞, ‚ÇΩ"],
    df["–ó–∞–∫–∞–∑–∞–Ω–æ, —à—Ç—É–∫–∏"],
    alpha=0.4
)

plt.xlabel("–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞, ‚ÇΩ")
plt.ylabel("–ó–∞–∫–∞–∑–∞–Ω–æ, —à—Ç—É–∫–∏")
plt.title("–í–ª–∏—è–Ω–∏–µ —Ü–µ–Ω—ã –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤")
plt.show()
